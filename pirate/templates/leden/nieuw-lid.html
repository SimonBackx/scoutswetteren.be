{% extends "base.html" %}

{% block main %}
    <main>
        <div class="white block">
                <form method="post">
                    <div class="text">
                        
                        <h1>Nieuw lid inschrijven</h1>

                        <input type="hidden" id="leden-aantal" name="leden-aantal" value="{{ max(1, leden | length) }}">
                        <input type="hidden" id="ouders-aantal" name="ouders-aantal" value="{{ max(1, ouders | length) }}">

                        {% for i in 0..5 %}
                            {% set lid = leden[loop.index0] %}
                            <div class="grouped splitted" id="leden-{{ loop.index }}"{% if loop.index > 1 and lid | length == 0 %} style="display: none;"{% endif %}>
                                <div class="part column first">
                                    <label>Voornaam</label>
                                    <input type="text" name="lid-voornaam-{{ loop.index }}" placeholder="Voornaam van het kind / de jongere" value="{{ lid['voornaam'] | e('html_attr') }}" required="required">

                                    <label>Achternaam</label>
                                    <input type="text" class="achternaam" name="lid-achternaam-{{ loop.index }}" placeholder="Naam van het kind / de jongere" value="{{ lid.achternaam | e('html_attr') }}" required="required">

                                    <label>Geslacht</label>
                                    <input id="geslacht-jongen-{{ loop.index }}" type="radio" name="lid-geslacht-{{ loop.index }}" value="M"{% if lid.geslacht != 'V' %} checked{% endif %}>
                                    <label for="geslacht-jongen-{{ loop.index }}">Jongen</label>

                                    <input id="geslacht-meisje-{{ loop.index }}" type="radio" name="lid-geslacht-{{ loop.index }}" value="V"{% if lid.geslacht == 'V' %} checked{% endif %}>
                                    <label for="geslacht-meisje-{{ loop.index }}">Meisje</label>
                                
                                    {% if lid.errors|length > 0 %}
                                        <ul class="error">
                                            {% for error in lid.errors %}
                                                <li>{{ error }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>

                                <div class="part column last">
                                    <label>Geboortedatum</label>
                                    <input type="text" name="lid-geboortedatum-{{ loop.index }}" class="lid-geboortedatum datepicker" placeholder="Kies een datum" value="{{ lid.geboortedatum | e('html_attr') }}" required="required">

                                    <aside class="kapoenen" style="display: none;">
                                        <p>
                                        Tak: kapoenen
                                        </p>
                                        <p>
                                            De Kapoenen is de tak voor de allerkleinsten. Het leven van een kapoen (6-8) is er één vol spel, fantasie, creativiteit en expressie. Sommigen gaan voor de eerste keer naar de scouts, voor de eerste keer op weekend, voor de eerste keer op kamp. Zoveel nieuwe dingen! Wat doen we bij de kapoenen? We spelen, we ravotten, we maken ons vuil, we kliederen en kladderen, we zingen, we klimmen in de bomen... Een heleboel dus! Speelkledij is een must!
                                        </p>
                                    </aside>
                                    <aside class="wouters" style="display: none;">
                                        <p>
                                        Tak: wouters
                                        </p>
                                        <p>
                                            Wie tussen 8 en 11 jaar is, kan meespelen bij de wouters. Zij voelen zich vaak al ervaren scouten, en dat zijn ze eigenlijk ook wel een beetje. Wouters worden zich steeds meer bewust van wat er rond hen gebeurt: op school, thuis en op de scouts. Ze krijgen ruimte en kansen om dingen uit te proberen en van elkaar te leren. Ze verleggen hun grenzen, halen kattenkwaad uit en kunnen vooral onbezorgd spelen.
                                        </p>
                                    </aside>
                                    <aside class="jonggivers" style="display: none;">
                                        <p>
                                        Tak: jonggivers
                                        </p>
                                        <p>
                                            De jonggivers, een geval apart. Niet oud, maar ook niet zo jong meer. In ieder geval in volle ontwikkeling. Ze mogen al alleen op pad, leren sjorren, kaartlezen en gaan op tentenkamp, waar ze zelfs hun eigen potje leren koken! Jonggivers krijgen een waaier van mogelijkheden om mee te beslissen, zelf de handen uit de mouwen te steken en allerlei vaardigheden onder de knie te krijgen. Een tak boordevol nieuwe dingen!
                                        </p>
                                    </aside>
                                    <aside class="givers" style="display: none;">
                                        <label>GSM van de jongere</label>
                                        <input type="text" name="lid-gsm-{{ loop.index }}" placeholder="Vul GSM nummer in van het lid" value="{{ lid.gsm | e('html_attr') }}" required="required">

                                        <p>
                                        Tak: givers
                                        </p>
                                        <p>
                                            Givers trekken samen op, hun vrienden zijn heilig. Ze hechten heel veel belang aan de groepssfeer. Van hun leiding krijgen ze alle mogelijkheden, ervaringen, spanning en enthousiasme die ze alleen binnen scoutsing kunnen vinden. Maar givers hebben ook hun eigen willetje. Ze krijgen dan ook elke keer dat ietsje meer. Dat ietsje meer participatie, dat ietsje meer zelfstandigheid, dat ietsje meer uitdaging. Als je hier zit, ben je al een echte!
                                        </p>
                                    </aside>
                                    <aside class="jin" style="display: none;">
                                        <p>
                                        Tak: jin
                                        </p>
                                        <p>
                                           Jin, Jij en Ik een Noodzaak. Als jin sta je op een grens: die tussen lid en leiding. In hun eigen 'jonge' stijl werken ze gekke activiteiten, projecten en zelfs hun kamp uit. Al doende leren ze samen te werken en verantwoordelijkheid op te nemen. Hieruit groeit engagement voor de groep en voor de samenleving. Het is een jaar waarin ze hun eigen zegje hebben, waar ze samen met hun medejin tot ideeën komen en ze samen uitwerken. De jin gaat op buitenlands kamp. Ze organiseren financiële activiteiten om dat te kunnen bekostigen. Ze mogen zelf hun kamp invullen en vorm geven. Jin, gun ze hun apenjaar!
                                        </p>
                                    </aside>
                                    <aside class="ongeldig" style="display: none;">
                                        <p>
                                            Jouw zoon/dochter is te jong/oud voor onze scouts. Leden zijn welkom vanaf 6 jaar, of als ze nog 6 jaar worden in dat jaar.
                                        </p>
                                    </aside>
                                </div>

                            </div>
                        {% endfor %}
                        <button class="icon-button plus add-count" data-field="leden" data-move="achternaam" data-max="6">Zus / broer toevoegen</button>

                        <h1>Ouders of voogd</h1>

                        {% for i in 0..3 %}
                            {% set ouder = ouders[loop.index0] %}
                            <div class="grouped splitted" id="ouders-{{ loop.index }}"{% if loop.index > 1 and ouder | length == 0 %} style="display: none;"{% endif %}>
                                <div class="part column first">
                                    <label>Titel</label>
                                    <label class="select-box">
                                        <select required="required" name="ouder-functie-{{ loop.index }}">
                                            <option disabled selected hidden>Maak een keuze</option>
                                            {% for titel in titels %}
                                                <option value="{{ titel }}"{% if titel == ouder.titel %} selected{% endif %}>{{ titel }}</option>
                                            {% endfor %}
                                        </select>
                                    </label>

                                    <label>Voornaam</label>
                                    <input type="text" name="ouder-voornaam-{{ loop.index }}" placeholder="Voornaam van de ouder" value="{{ ouder.voornaam | e('html_attr') }}" required="required">

                                    <label>Achternaam</label>
                                    <input type="text" name="ouder-achternaam-{{ loop.index }}" placeholder="Naam van de ouder" value="{{ ouder.achternaam | e('html_attr') }}" required="required">

                                    <label>Adres</label>
                                    <input type="text" class="adres" name="ouder-adres-{{ loop.index }}" placeholder="Straat en nummer" value="{{ ouder.adres | e('html_attr') }}" required="required">
                                
                                    {% if ouder.errors|length > 0 %}
                                        <ul class="error">
                                            {% for error in ouder.errors %}
                                                <li>{{ error }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>

                                <div class="part column last">
                                    <label>Gemeente</label>
                                    <input type="text" class="gemeente" name="ouder-gemeente-{{ loop.index }}" placeholder="Vul de gemeente in van de ouder" value="{{ ouder.gemeente | e('html_attr') }}" required="required">

                                    <label>GSM of telefoon</label>
                                    <input type="text" name="ouder-telefoon-{{ loop.index }}" placeholder="Vul nummer van de ouder in" value="{{ ouder.telefoon | e('html_attr') }}" required="required">

                                    <label>E-mailadres</label>
                                    <input type="text" name="ouder-email-{{ loop.index }}" placeholder="Vul e-mailadres van de ouder in" value="{{ ouder.email | e('html_attr') }}" required="required">
                                    
                                </div>

                            </div>
                        {% endfor %}

                        <button class="icon-button plus add-count" data-field="ouders" data-move="adres,gemeente" data-max="4">Ouder toevoegen</button>

                        <div class="splitted grouped">
                                <div class="part column first">
                                    <label>Opmerkingen huisbezoeken</label>
                                    <p>Na het inschrijven van nieuwe leden en net voor kamp, gebeurt het soms dat we op huisbezoek komen als we dit nuttig vinden. Maar het is onmogelijk om voor elk lid een datum / tijdstip af te spreken, daarom kan je hieronder enkele opmerkingen achterlaten.</p>
                                    <textarea type="text" name="opmerkingen-huisbezoek" placeholder="Bv. dagen en uren waarop huisbezoeken niet mogelijk zijn">{{ data.huisbezoeken }}</textarea>

                                    {% if errors|length > 0 %}
                                        <ul class="error">
                                            {% for error in errors %}
                                                <li>{{ error }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>

                                <div class="part column last">
                                    <label>Belangrijke afspraken vanuit de gezinssituatie</label>
                                    <textarea type="text" name="afspraken-gezinssituatie" placeholder="Bv. regeling echtscheiding">{{ data.gezinssituatie }}</textarea>
                                </div>

                            </div>



                        <footer>
                            <input type="submit" class="aubergine fill" value="Opslaan">
                            <a href="/admin/wachtwoord-wijzigen" class="button merlot">Wachtwoord aanpassen</a>
                        </footer>

                    </div>
                </form>
        </div>
        <script type="text/javascript">
            var geboortedatums = {
                 2009: 'kapoenen', 2010: 'kapoenen',
                 2008: 'wouters', 2007: 'wouters', 2006: 'wouters', 
                 2005: 'jonggivers', 2004: 'jonggivers', 2003: 'jonggivers',
                 2002: 'givers', 2001: 'givers', 2000: 'givers',
                 1999: 'jin'
             };

            $( document ).ready(function() {
                $('.add-count').click(function(event) {
                    event.preventDefault();
                    var field = $(this).attr('data-field');
                    var max = parseInt($(this).attr('data-max'));
                    var aantal_el = $('#'+field+'-aantal');

                    var aantal = parseInt(aantal_el.val());
                    var last_one = $('#'+field+'-'+aantal);
                    aantal++;
                    aantal_el.val(aantal);
                    var new_one = $('#'+field+'-'+aantal);
                    new_one.show();

                    if (aantal >= max) {
                        $(this).hide();
                    }
                    new_one.find('input')[0].focus();

                    var move_raw = $(this).attr('data-move');
                    var move = move_raw.split(',');
                    if (move.length > 0) {
                        for (var i = 0; i < move.length; i++) {
                            var cl = move[i];
                            var ori = last_one.find('.'+cl);
                            var ne = new_one.find('.'+cl);
                            ne.val(ori.val());
                        }
                    }
                });

                $('.lid-geboortedatum').change(function() {
                    var year = parseInt($(this).val().substr(6,4));
                    $(this).siblings('aside').hide();

                    if (isNaN(year)) {
                        return;
                    } 

                    if (typeof geboortedatums[year] === 'undefined') {
                        $(this).siblings('aside.ongeldig').show();
                    } else {
                        $(this).siblings('aside.'+geboortedatums[year]).show();
                    }
                });
            });
        </script>

        {{ include('call_to_action.html') }}
    </main>
{% endblock %}